<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JMatrix Generator</title>
    <style>
        /* Speed-optimized CSS with minimal reflows */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
        }

        .viewer-container {
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            overflow: hidden;
        }

        .controls {
            background: #f8f9fa;
            padding: 20px;
            border-bottom: 1px solid #e9ecef;
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }

        .btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s ease;
        }

        .btn:hover {
            background: #0056b3;
            transform: translateY(-1px);
        }

        .btn:disabled {
            background: #6c757d;
            cursor: not-allowed;
            transform: none;
        }

        .btn.success {
            background: #28a745;
        }

        .btn.success:hover {
            background: #218838;
        }

        .status {
            flex: 1;
            text-align: center;
            font-weight: 500;
        }

        .status.loading {
            color: #007bff;
        }

        .status.error {
            color: #dc3545;
        }

        .status.success {
            color: #28a745;
        }

        .url-display {
            background: #f8f9fa;
            padding: 15px 20px;
            border-bottom: 1px solid #e9ecef;
            font-family: 'Courier New', monospace;
            word-break: break-all;
            font-size: 14px;
        }

        .source-container {
            position: relative;
            height: 600px;
            background: #f8f9fa;
            overflow: auto;
        }

        .source-content {
            width: 100%;
            height: 100%;
            padding: 20px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            white-space: pre-wrap;
            background: white;
            overflow: auto;
        }

        .loading-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255,255,255,0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            color: #007bff;
            z-index: 10;
        }

        .stats {
            background: #f8f9fa;
            padding: 15px 20px;
            border-top: 1px solid #e9ecef;
            display: flex;
            justify-content: space-between;
            font-size: 14px;
            color: #6c757d;
        }

        .progress-bar {
            width: 100%;
            height: 4px;
            background: #e9ecef;
            border-radius: 2px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #007bff, #28a745);
            width: 0%;
            transition: width 0.3s ease;
        }

        .fractal-component {
            border: 1px solid #e9ecef;
            border-radius: 8px;
            margin: 10px 0;
            padding: 15px;
            background: white;
        }

        .fractal-header {
            font-weight: bold;
            color: #495057;
            margin-bottom: 10px;
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        @media (max-width: 768px) {
            .controls {
                flex-direction: column;
                align-items: stretch;
            }

            .btn {
                width: 100%;
            }

            .stats {
                flex-direction: column;
                gap: 5px;
            }
            
            .source-container {
                height: 400px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Javascript: matrix generator (Source Viewer)</h1>
        </div>

        <div class="viewer-container">
            <div class="fractal-component">
                <div class="fractal-header">Navigation Controls</div>
                <div class="controls">
                    <button class="btn" id="prevBtn">← Previous</button>
                    <button class="btn" id="nextBtn">Next →</button>
                    <button class="btn" id="playBtn">▶ Auto Play</button>
                    <button class="btn success" id="reloadBtn">↻ Reload</button>
                    <div class="status" id="status">Ready</div>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
            </div>

            <div class="fractal-component">
                <div class="fractal-header">Current URL</div>
                <div class="url-display" id="urlDisplay">https://0-1.one</div>
            </div>

            <div class="fractal-component">
                <div class="fractal-header">Source Code Viewer</div>
                <div class="source-container">
                    <div class="loading-overlay" id="loadingOverlay">Loading...</div>
                    <pre class="source-content" id="sourceContent"></pre>
                </div>
            </div>

            <div class="fractal-component">
                <div class="fractal-header">Statistics</div>
                <div class="stats">
                    <span id="currentIndex">URL 1 of 699,724</span>
                    <span id="loadTime">Load Time: 0ms</span>
                    <span id="successRate">Success Rate: 0%</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        'use strict';

        class SequentialURLViewer {
            constructor() {
                this.cacheElements();
                this.urls = [];
                this.currentIndex = 0;
                this.isPlaying = false;
                this.playInterval = null;
                this.successCount = 0;
                this.loadStartTime = 0;
                this.debounceTimer = null;
                this.cache = new Map();
                this.totalUrls = 0;
                this.loadedUrls = 0;
                this.batchSize = 1000;
                
                this.init();
            }

            cacheElements() {
                this.elements = {
                    prevBtn: document.getElementById('prevBtn'),
                    nextBtn: document.getElementById('nextBtn'),
                    playBtn: document.getElementById('playBtn'),
                    reloadBtn: document.getElementById('reloadBtn'),
                    status: document.getElementById('status'),
                    urlDisplay: document.getElementById('urlDisplay'),
                    sourceContent: document.getElementById('sourceContent'),
                    loadingOverlay: document.getElementById('loadingOverlay'),
                    progressFill: document.getElementById('progressFill'),
                    currentIndex: document.getElementById('currentIndex'),
                    loadTime: document.getElementById('loadTime'),
                    successRate: document.getElementById('successRate')
                };
            }

            async init() {
                this.updateStatus('Initializing...', 'loading');

                try {
                    await this.loadURLs();
                    this.setupEventListeners();
                    this.loadCurrentURL();
                    this.updateStatus('Ready', 'success');
                } catch (error) {
                    this.updateStatus('Initialization failed', 'error');
                    console.error('Initialization error:', error);
                }
            }

            async loadURLs() {
                try {
                    const response = await fetch('https://raw.githubusercontent.com/cenk/nrd/refs/heads/main/nrd-last-10-days.txt');
                    const text = await response.text();
                    
                    const allUrls = text.split('\n')
                        .filter(line => line.trim() && !line.startsWith('#'))
                        .map(line => line.trim())
                        .filter(line => line.includes('.'));
                    
                    this.totalUrls = allUrls.length;
                    this.urls = allUrls.slice(0, this.batchSize);
                    this.loadedUrls = this.batchSize;
                    
                    console.log(`Loaded ${this.urls.length} of ${this.totalUrls} URLs`);
                } catch (error) {
                    console.error('Failed to load URLs:', error);
                    this.urls = [
                        'https://0-1.one',
                        'https://0-1c.com',
                        'https://0-centra.org',
                        'https://00-00.net',
                        'https://00.law'
                    ];
                    this.totalUrls = this.urls.length;
                }
            }

            async loadMoreUrls() {
                if (this.loadedUrls >= this.totalUrls) return;
                
                try {
                    const response = await fetch('https://raw.githubusercontent.com/cenk/nrd/refs/heads/main/nrd-last-10-days.txt');
                    const text = await response.text();
                    
                    const allUrls = text.split('\n')
                        .filter(line => line.trim() && !line.startsWith('#'))
                        .map(line => line.trim())
                        .filter(line => line.includes('.'));
                    
                    const newUrls = allUrls.slice(this.loadedUrls, this.loadedUrls + this.batchSize);
                    this.urls = [...this.urls, ...newUrls];
                    this.loadedUrls += newUrls.length;
                    
                    console.log(`Loaded additional ${newUrls.length} URLs. Total: ${this.urls.length}`);
                } catch (error) {
                    console.error('Failed to load more URLs:', error);
                }
            }

            setupEventListeners() {
                this.elements.prevBtn.addEventListener('click', () => this.previousURL());
                this.elements.nextBtn.addEventListener('click', () => this.nextURL());
                this.elements.playBtn.addEventListener('click', () => this.toggleAutoPlay());
                this.elements.reloadBtn.addEventListener('click', () => this.reloadCurrentURL());

                this.keydownHandler = (e) => {
                    switch(e.key) {
                        case 'ArrowLeft':
                            this.previousURL();
                            break;
                        case 'ArrowRight':
                        case ' ':
                            e.preventDefault();
                            this.nextURL();
                            break;
                        case 'Enter':
                            this.toggleAutoPlay();
                            break;
                    }
                };
                
                document.addEventListener('keydown', this.keydownHandler);
            }

            async loadCurrentURL() {
                if (this.urls.length === 0) return;

                const url = this.urls[this.currentIndex];
                const fullURL = url.startsWith('http') ? url : `https://${url}`;

                this.elements.urlDisplay.textContent = fullURL;
                this.elements.loadingOverlay.style.display = 'flex';
                this.loadStartTime = performance.now();

                try {
                    this.updateStatus('Fetching source...', 'loading');
                    
                    // Load more URLs if we're near the end
                    if (this.currentIndex > this.urls.length - 100) {
                        await this.loadMoreUrls();
                    }

                    const proxyResponse = await fetch(`https://queer.onrender.com/code.py?url=${encodeURIComponent(fullURL)}`);
                    
                    if (!proxyResponse.ok) {
                        throw new Error(`HTTP error! Status: ${proxyResponse.status}`);
                    }
                    
                    const data = await proxyResponse.json();

                    if (data.error) {
                        throw new Error(data.error);
                    }

                    this.elements.sourceContent.textContent = data.html;
                    this.onURLLoad(data.size);

                } catch (error) {
                    this.onURLError(error.message);
                }
            }

            onURLLoad(size) {
                const loadTime = Math.round(performance.now() - this.loadStartTime);
                this.elements.loadingOverlay.style.display = 'none';
                this.elements.loadTime.textContent = `Size: ${size} | Time: ${loadTime}ms`;
                this.updateStatus('Loaded successfully', 'success');
                this.successCount++;
                this.updateStats();
            }

            onURLError(errorMessage) {
                this.elements.loadingOverlay.style.display = 'none';
                this.elements.sourceContent.textContent = `Error: ${errorMessage}`;
                this.updateStatus('Failed to load source', 'error');
                this.updateStats();

                if (this.isPlaying) {
                    setTimeout(() => {
                        this.nextURL();
                    }, 2000);
                }
            }

            previousURL() {
                if (this.currentIndex > 0) {
                    this.currentIndex--;
                    this.loadCurrentURL();
                }
            }

            nextURL() {
                if (this.currentIndex < this.urls.length - 1) {
                    this.currentIndex++;
                    this.loadCurrentURL();
                } else {
                    this.updateStatus('End of URLs', 'error');
                    this.stopAutoPlay();
                }
            }

            reloadCurrentURL() {
                this.loadCurrentURL();
            }

            toggleAutoPlay() {
                if (this.isPlaying) {
                    this.stopAutoPlay();
                } else {
                    this.startAutoPlay();
                }
            }

            startAutoPlay() {
                this.isPlaying = true;
                this.elements.playBtn.textContent = '⏸ Pause';
                this.playInterval = setInterval(() => {
                    this.nextURL();
                }, 5000);
            }

            stopAutoPlay() {
                this.isPlaying = false;
                this.elements.playBtn.textContent = '▶ Auto Play';
                if (this.playInterval) {
                    clearInterval(this.playInterval);
                    this.playInterval = null;
                }
            }

            updateStatus(message, type = '') {
                this.elements.status.textContent = message;
                this.elements.status.className = `status ${type}`;
            }

            updateUI() {
                const progress = this.totalUrls > 0 ? 
                    ((this.currentIndex + 1) / this.totalUrls) * 100 : 0;
                this.elements.progressFill.style.width = `${progress}%`;

                this.elements.currentIndex.textContent = 
                    `URL ${this.currentIndex + 1} of ${this.totalUrls}`;

                this.elements.prevBtn.disabled = this.currentIndex === 0;
                this.elements.nextBtn.disabled = this.currentIndex === this.urls.length - 1;
            }

            updateStats() {
                const successRate = this.currentIndex > 0 ?
                    Math.round((this.successCount / (this.currentIndex + 1)) * 100) : 0;
                this.elements.successRate.textContent = `Success Rate: ${successRate}%`;
                
                this.updateUI();
            }

            cleanup() {
                this.stopAutoPlay();
                if (this.keydownHandler) {
                    document.removeEventListener('keydown', this.keydownHandler);
                }
            }
        }

        // Initialize when DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', () => {
                window.viewer = new SequentialURLViewer();
            });
        } else {
            window.viewer = new SequentialURLViewer();
        }

        // Memory management
        window.addEventListener('beforeunload', () => {
            if (window.viewer) {
                window.viewer.cleanup();
            }
        });
    </script>
</body>
</html>
