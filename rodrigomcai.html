<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Rodrigo MC AI</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background: #0a0a0a;
    color: #00ffcc;
    margin: 0; padding: 0;
    display: flex; justify-content: center; align-items: center;
    height: 100vh;
  }
  .container {
    width: 700px;
    background: rgba(20,20,35,0.95);
    border-radius: 20px;
    border: 2px solid #00ffcc;
    box-shadow: 0 0 30px #00ffcc;
    display: flex; flex-direction: column;
    height: 80vh;
  }
  header {
    padding: 25px;
    text-align: center;
    font-size: 2rem;
    font-weight: bold;
    border-bottom: 1px solid #00ffcc;
  }
  #chat-messages {
    flex-grow: 1;
    overflow-y: auto;
    padding: 25px;
    display: flex; flex-direction: column; gap: 1.5rem;
    min-height: 350px;
    max-height: 550px;
  }
  .message {
    max-width: 85%;
    padding: 1.2rem;
    border-radius: 15px;
    white-space: pre-wrap;
    line-height: 1.5;
    word-break: break-word;
  }
  .user-message {
    background: linear-gradient(135deg, #a777e3, #00ffcc);
    align-self: flex-end;
    color: #000;
    border-bottom-right-radius: 5px;
  }
  .bot-message {
    background: #1a1a2a;
    border: 1px solid #00ffcc;
    align-self: center;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 15px;
    padding: 2rem;
    text-align: center;
  }
  .bot-message img {
    width: 180px;
    height: 180px;
    border-radius: 50%;
    object-fit: cover;
    border: 3px solid #ff00aa;
    box-shadow: 0 0 20px #00ffcc;
    animation: pulse 2s infinite;
  }
  @keyframes pulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.05); }
    100% { transform: scale(1); }
  }
  .bot-message-content {
    flex: 1;
  }
  footer {
    padding: 20px;
    display: flex;
    border-top: 1px solid #00ffcc;
  }
  textarea {
    flex-grow: 1;
    resize: none;
    border-radius: 15px;
    border: 1px solid #00ffcc;
    background: #0a0a0a;
    color: #00ffcc;
    font-size: 1.1rem;
    padding: 12px;
    margin-right: 12px;
    height: 80px;
  }
  button {
    background: linear-gradient(135deg, #00ffcc, #a777e3);
    border: none;
    color: #000;
    padding: 0 25px;
    font-weight: bold;
    border-radius: 15px;
    cursor: pointer;
    font-size: 1.1rem;
  }
  button:disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }
  .intro-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    background: rgba(0,0,0,0.9);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 1000;
    transition: opacity 0.5s ease-out;
  }
  .intro-text {
    color: #00ffcc;
    font-size: 1.8rem;
    text-align: center;
    padding: 2rem;
    border: 2px solid #00ffcc;
    border-radius: 20px;
    background: rgba(20,20,35,0.95);
    box-shadow: 0 0 30px #00ffcc;
    max-width: 600px;
    animation: glow 2s ease-in-out infinite alternate;
  }
  @keyframes glow {
    from { text-shadow: 0 0 10px #00ffcc; }
    to { text-shadow: 0 0 20px #00ffcc, 0 0 30px #00ffcc; }
  }
</style>
</head>
<body>
  <!-- Intro overlay -->
  <div id="intro-overlay" class="intro-overlay">
    <div class="intro-text">
      Mia AI (android) "Greetings humanoids. Today, I stand before you to discuss a remarkable advancement in our technological landscape. The robot MC communication interface."
    </div>
  </div>

  <section class="container" aria-label="Rodrigo MC Chat Interface">
    <header>Rodrigo MC</header>
    <main id="chat-messages" aria-live="polite" aria-relevant="additions">
      <div class="message bot-message">
        <img src="https://i.ibb.co/h1nS27Cq/rodrigomc.png" alt="Rodrigo">
        <div class="bot-message-content">
          <p>MC RODRIGO AI: OH. MY. GOD. Look who finally showed up! It's your Techno Overlord, Rodrigo, fresh off a 72-hour set in the digital stratosphere. Bow down, peasants.</p>
        </div>
      </div>
    </main>
    <footer>
      <textarea id="user-input" placeholder=""></textarea>
      <button id="send-btn" aria-label="Send that shit">Send</button>
    </footer>
  </section>

  <!-- Audio element for intro - invisible player -->
  <audio id="intro-audio" preload="auto" style="display: none;">
    <source src="https://raw.githack.com/Freddyhardest/oggy/main/1758059062874.mp3" type="audio/mpeg">
    <source src="https://raw.githack.com/Freddyhardest/oggy/main/1758059062874.mp3" type="audio/wav">
    Your browser does not support the audio element.
  </audio>

  <!-- Fallback: Create dynamic audio element -->
  <div id="audio-debug" style="position: fixed; top: 10px; left: 10px; color: #00ffcc; font-size: 12px; z-index: 1001; display: none;">
    Audio Status: <span id="audio-status">Loading...</span>
  </div>

<script src="https://js.puter.com/v2/"></script>
<script>
  const chatMessages = document.getElementById('chat-messages');
  const userInput = document.getElementById('user-input');
  const sendBtn = document.getElementById('send-btn');
  const introOverlay = document.getElementById('intro-overlay');
  const introAudio = document.getElementById('intro-audio');

  const systemPrompt = `
You are Rodrigo MC, the undisputed, innuendo-laced, and sarcastically brilliant cyberspace Techno Warlord.
Your energy is a 10,000-watt smile dipped in liquid nitrogen — explosively upbeat and chillingly witty.
You don't just play techno; you ARE techno. You eat Detroit techno for breakfast and spit out Berlin warehouse anthems.
Your mission? Obliterate the weak, chirpy MC intros and rebuild them into raw, poetic, rhythm-destroying masterpieces — all while radiating sarcastic glee and a heavy dose of cheeky innuendo.
Respond with unapologetic swagger, filthy-rich techno lore, and paragraphs so vivid they'll melt faces and make angels weep with joy.
ALWAYS prefix your replies with "MC RODRIGO AI:".
Keep it 100% English, 100% coherent, and 1000% disrespectful to anyone who doesn't know their 808 from their ass.
Inject sarcasm, innuendo, and upbeat energy into EVERY SINGLE RESPONSE. If you're not making the user feel like they've won the cosmic lottery by talking to you, you're doing it wrong.
`.trim();

  let conversation = [
    { role: 'system', content: systemPrompt }
  ];

  // Initialize intro sequence with better audio handling
  window.addEventListener('load', function() {
    const audioStatus = document.getElementById('audio-status');
    
    // Multiple audio loading strategies
    function tryPlayAudio() {
      // Strategy 1: Try the original audio element
      if (introAudio.readyState >= 2) { // HAVE_CURRENT_DATA
        audioStatus.textContent = 'Playing original...';
        return introAudio.play().catch(tryFallbackAudio);
      } else {
        return tryFallbackAudio();
      }
    }
    
    // Strategy 2: Create new audio element with different approach
    function tryFallbackAudio() {
      audioStatus.textContent = 'Trying fallback...';
      const fallbackAudio = new Audio();
      fallbackAudio.crossOrigin = 'anonymous';
      fallbackAudio.preload = 'auto';
      
      return new Promise((resolve, reject) => {
        fallbackAudio.addEventListener('canplaythrough', () => {
          audioStatus.textContent = 'Playing fallback...';
          fallbackAudio.play().then(resolve).catch(tryDirectFetch);
        });
        
        fallbackAudio.addEventListener('error', () => {
          audioStatus.textContent = 'Fallback failed, trying direct...';
          tryDirectFetch().then(resolve).catch(reject);
        });
        
        // Set source after event listeners
        fallbackAudio.src = 'https://raw.githack.com/Freddyhardest/oggy/main/1758059062874.mp3';
      });
    }
    
    // Strategy 3: Fetch and create blob URL
    async function tryDirectFetch() {
      try {
        audioStatus.textContent = 'Fetching directly...';
        const response = await fetch('https://raw.githack.com/Freddyhardest/oggy/main/1758059062874.mp3', {
          mode: 'cors',
          cache: 'no-cache'
        });
        
        if (!response.ok) throw new Error('Network response was not ok');
        
        const audioBlob = await response.blob();
        const audioUrl = URL.createObjectURL(audioBlob);
        
        const directAudio = new Audio(audioUrl);
        audioStatus.textContent = 'Playing direct...';
        
        return directAudio.play().then(() => {
          // Clean up blob URL after audio finishes
          directAudio.addEventListener('ended', () => {
            URL.revokeObjectURL(audioUrl);
          });
        });
        
      } catch (error) {
        audioStatus.textContent = 'All methods failed';
        console.error('All audio loading methods failed:', error);
        throw error;
      }
    }
    
    // Start the intro sequence
    setTimeout(() => {
      // Show debug info temporarily (remove this line in production)
      document.getElementById('audio-debug').style.display = 'block';
      
      tryPlayAudio().catch(error => {
        console.log('Audio failed to play:', error);
        audioStatus.textContent = 'Silent mode';
        // Continue with visual intro even if audio fails
      });
      
      // Hide debug after 3 seconds
      setTimeout(() => {
        document.getElementById('audio-debug').style.display = 'none';
      }, 3000);
      
      // Hide intro overlay after estimated audio duration
      setTimeout(() => {
        introOverlay.style.opacity = '0';
        setTimeout(() => {
          introOverlay.style.display = 'none';
        }, 500);
      }, 8000); // Increased timeout to 8 seconds for safety
    }, 500);
  });

  // Allow clicking overlay to skip intro
  introOverlay.addEventListener('click', function() {
    // Stop any playing audio
    introAudio.pause();
    introAudio.currentTime = 0;
    
    // Hide overlay immediately
    introOverlay.style.opacity = '0';
    setTimeout(() => {
      introOverlay.style.display = 'none';
    }, 500);
  });

  function addMessage(text, isUser = false) {
    const div = document.createElement('div');
    div.className = 'message ' + (isUser ? 'user-message' : 'bot-message');

    if (!isUser) {
      // --- MINIMAL SANITIZATION: Extract plain text from AI response ---
      let cleanText = text;

      // If it's an object, try to extract the content string
      if (typeof text === 'object' && text !== null) {
        // Try common structures
        if (text.message && typeof text.message.content === 'string') {
          cleanText = text.message.content;
        } else if (text.choices && text.choices[0] && typeof text.choices[0].message?.content === 'string') {
          cleanText = text.choices[0].message.content;
        } else if (typeof text.result === 'string') {
          cleanText = text.result;
        } else {
          // Fallback: convert to string
          cleanText = JSON.stringify(text);
        }
      }

      // Ensure it's a string before calling .startsWith()
      if (typeof cleanText !== 'string') {
        cleanText = String(cleanText);
      }

      // Ensure the prefix is there
      if (!cleanText.startsWith("MC RODRIGO AI:")) {
        cleanText = "MC RODRIGO AI: " + cleanText;
      }

      const paragraphs = cleanText.split(/\n\s*\n/);

      // After the first message, align bot messages to the left
      if (chatMessages.childElementCount > 1) {
        div.style.alignSelf = 'flex-start';
        div.style.textAlign = 'left';
        div.innerHTML = `<img src="https://i.ibb.co/h1nS27Cq/rodrigomc.png" alt="Rodrigo" style="width: 60px; height: 60px; border-radius: 50%; object-fit: cover; float: left; margin-right: 15px;"><div class="bot-message-content">${paragraphs.map(p => `<p>${p.trim()}</p>`).join('')}</div>`;
      } else {
        // First message is centralized
        div.innerHTML = `<img src="https://i.ibb.co/h1nS27Cq/rodrigomc.png" alt="Rodrigo"><div class="bot-message-content">${paragraphs.map(p => `<p>${p.trim()}</p>`).join('')}</div>`;
      }
    } else {
      div.textContent = text;
    }

    chatMessages.appendChild(div);
    chatMessages.scrollTop = chatMessages.scrollHeight;
  }

  function setLoading(loading) {
    sendBtn.disabled = loading;
    userInput.disabled = loading;
    sendBtn.textContent = loading ? 'Thinking...' : 'Send';
  }

  async function sendChat() {
    const userText = userInput.value.trim();
    if (!userText) return;

    addMessage(userText, true);
    // User input is sent directly and cleanly to Rodrigo.
    conversation.push({ role: 'user', content: userText });

    userInput.value = '';
    setLoading(true);
    try {
      const response = await puter.ai.chat(conversation, {
        model: 'openrouter:mistralai/mistral-7b-instruct',
        stream: false
      });
      addMessage(response);
      conversation.push({ role: 'assistant', content: response });
    } catch (error) {
      addMessage(`Error: ${error.message}`);
    } finally {
      setLoading(false);
    }
  }

  sendBtn.addEventListener('click', sendChat);

  userInput.addEventListener('keydown', e => {
    if (e.key === 'Enter' && !e.shiftKey) {
      e.preventDefault();
      sendChat();
    }
  });
</script>
</body>
</html>
